<!-- pacientes.html -->
{% extends './basegral.html' %}

{% block page_content %}

<div class="container rounded-4" gap-3 style="background-color: rgb(189, 189, 181, 0.432);">
  <!-- Buscar por paciente -->
  <div class="row mt-3 border border-3 rounded-4" style="background-color: rgb(248, 248, 233); ">
    
    <form id="filtro" action="pacientes" method="POST">
      <input type="hidden" name="csrf_token" value="{{ csrf_token()}}">
      <div class="col my-3">
        <div class="input-group">
          <label for="pacsel" class="me-3">Paciente:</label>
          <select name="pacsel" class="form-control select2 select2-hidden-accessible" style="width: 30%;" tabindex="-1" aria-hidden="true" title="Seleccionar Paciente">
            <option value="0">Todos</option>
            {% for itemx in TodPac %}
              <option value="{{ itemx[0] }}">{{ itemx[1] }} - {{ itemx[2] }} </option>
            {% endfor %}
          </select>
        
          <button class="btn btn-primary ms-2 mr-3" title="Buscar Paciente" type="submit" id="buscarBtn">Buscar</button>
          <button type="button" class="btn btn-primary ml-3" data-bs-toggle="modal" data-bs-target="#modal_add"
            title="Crear Nuevo Registro"> Agregar Paciente </button>
        </div>
      </div>
    </form>  
  </div>

  <!--- FORM MODAL PARA AGREGAR PACIENTE    --->
  <div id="modal_add" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
      aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title text-primary text-center">Agregar Nuevo Paciente </h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
          <form id="modal_add" action="AltaPaciente" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token()}}">
            <!---Campo:Nombre   ---->
            <div class="form-group">
              <label for="registro_nombre">Nombre</label>
              <input name="nombre" type="text" class="form-control" id="registro_nombre" placeholder="Ingrese Nombre" required>
            </div>
            <!---Campo:dni   ---->
            <div class="form-group">
              <label for="registro_dni">DNI</label>
              <input name="dni" type="text" class="form-control" id="registro_dni" placeholder="Ingrese DNI" required>
            </div>
            <!---Campo:telefono   ---->
            <div class="form-group">
              <label for="registro_telefono">Teléfono</label>
              <input name="telefono" type="text" class="form-control" id="registro_telefono" placeholder="Ingrese telefono">
            </div>
            <!---Campo:mail   ---->
            <div class="form-group">
              <label for="registro_mail">Mail</label>
              <input name="mail" type="email" class="form-control" id="registro_mail" placeholder="Ingrese Mail">
            </div>
            
            <!---Botón:Registra--->
            <button type="submit" class="btn btn-primary md-2">Registrar</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  
</div>


<!-- Cabecera lista de pacientes -->
<div class="row mt-2 border border-3 rounded-4" style="background-color: rgb(248, 248, 233);">
  <table class="table table-hover rounded-1">
    <thead>
      <tr>
        <th scope="col">Nombre</th>
        <th scope="col">DNI</th>
        <th scope="col">Teléfono</th>
        <th scope="col">Mail</th>
        
      </tr>
    </thead>
    <tbody>
      {% for itemx in Lista %}
        <tr>
          <td>{{ itemx[1] }}</td>
          <td>{{ itemx[2] }}</td>
          <td>{{ itemx[3] }}</td>
          <td>{{ itemx[4] }}</td>
          <td>
            <a href="EditarPaciente/{{ itemx[0] }}" class="btn" data-bs-toggle="modal"
              data-bs-target="#Editar_Pac{{ itemx[0] }}" type="button" >
              <i class="fa fa-edit" aria-hidden="true"></i>
            </a>
            <a class="btn" href="BorrarPaciente/{{ itemx[0] }}" onclick="return confirm('Seguro que desea eliminar el registro?')">
              <i class="fa fa-trash-o" aria-hidden="true"></i>
            </a>
          </td>
        </tr>



        <!--- FORM MODAL PARA EDITAR PACIENTE --->
        <div class="modal fade" id="Editar_Pac{{ itemx[0] }}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
          aria-labelledby="staticBackdropLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title text-primary text-center">Editar Datos del Paciente </h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <form id="Editar_Pac" method="POST" action="EditarPaciente/{{ itemx[0] }}">
                  <input type="hidden" name="id" value="{{ itemx[0] }}">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token()}}"> 
        
                  <!---Campo:Nombre   ---->
                  <div class="form-group">
                    <label for="registro_nombre">Nombre</label>
                    <input value="{{ itemx[1] }}" name="nombre" type="text" class="form-control" id="registro_nombre" placeholder="Ingrese Nombre" required>
                  </div>
                  <!---Campo:dni   ---->
                  <div class="form-group">
                    <label for="registro_dni">DNI</label>
                    <input value="{{ itemx[2] }}" name="dni" type="text" class="form-control" id="registro_dni" placeholder="Ingrese DNI" required>
                  </div>
                  <!---Campo:telefono   ---->
                  <div class="form-group">
                    <label for="registro_telefono">Teléfono</label>
                    <input value="{{ itemx[3] }}" name="telefono" type="text" class="form-control" id="registro_telefono"
                      placeholder="Ingrese telefono">
                  </div>
                  <!---Campo:mail   ---->
                  <div class="form-group">
                    <label for="registro_mail">Mail</label>
                    <input value="{{ itemx[4] }}" name="mail" type="email" class="form-control" id="registro_mail" placeholder="Ingrese Mail">
                  </div>
                  <!---Botón:Registra--->
                  <button type="submit" class="btn btn-primary md-2">Registrar</button>
                </form>
              </div>
              
          </div>
        </div>
      
      {% endfor %}
    </tbody>

  </table>
  {{ Pagination.links}}

</div>

<!-- Script para abrir comonente select2 con busqueda -->
<script>
  $(document).ready(function() {
      $('.select2').select2({
      closeOnSelect: true
  });
  });
</script>

{% endblock %}